import os
from pyrogram import Client, filters
from pyrogram.types import InlineKeyboardMarkup, InlineKeyboardButton, Message
from pytgcalls import PyTgCalls
from pytgcalls.types import AudioPiped
from telethon import TelegramClient
import tgcrypto

# ØªØ«Ø¨ÙŠØª Ø§Ù„Ù…ÙƒØªØ¨Ø§Øª ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ù„Ùˆ Ù…Ø´ Ù…ÙˆØ¬ÙˆØ¯Ø©
try:
    from pyrogram import Client, filters
    from pytgcalls import PyTgCalls
    from telethon import TelegramClient
    import tgcrypto
except ImportError:
    os.system("pip install pyrogram tgcrypto pytgcalls telethon")

# Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø¨ÙˆØª
api_id = "28938802"
api_hash = "b14817af4a8ea706237da4f212e15287"
bot_token = "7749439832:AAFbAn6A6z7cXSSluTihfIvSqHncQmkEV6M"

# Ø¬Ù„Ø³Ø§Øª Ø§Ù„Ø¨ÙˆØª ÙˆØ§Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯
app = Client("my_bot", api_id=api_id, api_hash=api_hash, bot_token=bot_token)
assistant = TelegramClient("1BJWap1sBuy9IezCO0DWySaPFKQDpopJAj04oTP0gyQFG0wXVFYkkK2CxWTMBBLWZBkKT6uuFLkdbexmJJeHxWswaToXhwVlbEo8Hfp-Zz3ubHQMDPt0_tjHmYvM4qD0Fk-sC9mAETVSpqSEgl_MGGhIfiLcgta_ZXSh452IxOpQ-Axx8In9slUnv1KyYyhjqAZiwe_3UyMTWFxzXuv5fPikU-H8BkIFGC3iJuR74ljFP-rfUGm80NYZGX14qWYrAQaDQaLvIAWrYy0YTsnIlefX8bYuC7DKsqElWQ6wTpKdTyVpt6QraO0mbz2bYYdR-YrZ1kqjrJJiv93NQv5QG_qwjD8hFWQg=", api_id, api_hash)
pytgcalls = PyTgCalls(app)

# 1. ØªØ´ØºÙŠÙ„ Ø§Ù„Ù…ÙˆØ³ÙŠÙ‚Ù‰ ÙÙŠ Ø§Ù„Ù…ÙƒØ§Ù„Ù…Ø§Øª
@app.on_message(filters.command("play") & filters.group)
async def play_music(client, message: Message):
    if message.reply_to_message and message.reply_to_message.audio:
        audio = message.reply_to_message.audio
        file_path = await message.reply_to_message.download()

        # ØªØ´ØºÙŠÙ„ Ø§Ù„ØµÙˆØª ÙÙŠ Ø§Ù„Ù…ÙƒØ§Ù„Ù…Ø© Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯
        await pytgcalls.join_group_call(
            message.chat.id,  # Ù…Ø¹Ø±Ù Ø§Ù„Ø¬Ø±ÙˆØ¨
            AudioPiped(file_path),  # ØªØ´ØºÙŠÙ„ Ø§Ù„ØµÙˆØª Ù…Ù† Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø°ÙŠ ØªÙ… ØªÙ†Ø²ÙŠÙ„Ù‡
        )
        
        await message.reply("ØªÙ… ØªØ´ØºÙŠÙ„ Ø§Ù„Ø£ØºÙ†ÙŠØ© ÙÙŠ Ø§Ù„Ù…ÙƒØ§Ù„Ù…Ø© ğŸ¶")
    else:
        await message.reply("ÙŠØ±Ø¬Ù‰ Ø§Ù„Ø±Ø¯ Ø¹Ù„Ù‰ Ø±Ø³Ø§Ù„Ø© ØªØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ù…Ù„Ù ØµÙˆØªÙŠ Ù„ØªØ´ØºÙŠÙ„Ù‡.")

@app.on_message(filters.command("stop") & filters.group)
async def stop_music(client, message: Message):
    await pytgcalls.leave_group_call(message.chat.id)
    await message.reply("ØªÙ… Ø¥ÙŠÙ‚Ø§Ù ØªØ´ØºÙŠÙ„ Ø§Ù„Ø£ØºÙ†ÙŠØ©.")

# 2. Ø£Ù„Ø¹Ø§Ø¨ ÙƒØª ØªÙˆÙŠØª
@app.on_message(filters.command("truthordare") & filters.group)
async def truth_or_dare(client, message):
    options = ["Ø­Ù‚ÙŠÙ‚Ø©", "ØªØ­Ø¯ÙŠ"]
    await message.reply_text(f"Ø§Ø®ØªØ±: {options}")

# 3. Ø§Ù„Ø±Ø¯ Ø¹Ù„Ù‰ Ù…Ù† ÙŠÙ†Ø§Ø¯ÙŠ Ø§Ù„Ù…Ø§Ù„Ùƒ
@app.on_message(filters.group)
async def mention_owner(client, message):
    if "Ø§Ù„Ù…Ø§Ù„Ùƒ" in message.text:
        await message.reply("Ø§Ù„Ù…Ø§Ù„Ùƒ Ù‡Ù†Ø§ Ù„Ùˆ Ù…Ø­ØªØ§Ø¬ Ø£ÙŠ Ø­Ø§Ø¬Ø©!")

# 4. ÙƒØªÙ… ÙˆØ­Ø¸Ø± ÙˆØªÙ‚ÙŠÙŠØ¯
@app.on_message(filters.command("ban") & filters.group)
async def ban_member(client, message):
    if message.reply_to_message:
        await client.kick_chat_member(message.chat.id, message.reply_to_message.from_user.id)
        await message.reply("ØªÙ… Ø­Ø¸Ø± Ø§Ù„Ø¹Ø¶Ùˆ.")

@app.on_message(filters.command("mute") & filters.group)
async def mute_member(client, message):
    if message.reply_to_message:
        await client.restrict_chat_member(message.chat.id, message.reply_to_message.from_user.id, can_send_messages=False)
        await message.reply("ØªÙ… ÙƒØªÙ… Ø§Ù„Ø¹Ø¶Ùˆ.")

# 5. Ø§Ù„Ø¥Ø°Ø§Ø¹Ø© ÙˆØ§Ù„Ø§Ø´ØªØ±Ø§Ùƒ Ø§Ù„Ø¥Ø¬Ø¨Ø§Ø±ÙŠ
@app.on_message(filters.command("broadcast") & filters.private)
async def broadcast(client, message):
    # Ø¥Ø±Ø³Ø§Ù„ Ø±Ø³Ø§Ù„Ø© Ù„Ù„Ø¥Ø°Ø§Ø¹Ø© Ù‡Ù†Ø§ØŒ ÙŠØªØ·Ù„Ø¨ Ù‚Ø§Ø¦Ù…Ø© Ø¨Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø§Øª Ø£Ùˆ Ø§Ù„Ù‚Ù†ÙˆØ§Øª
    await message.reply("ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¥Ø°Ø§Ø¹Ø© Ù„Ù„Ù…Ø¬Ù…ÙˆØ¹Ø§Øª Ø§Ù„Ù…Ø­Ø¯Ø¯Ø©.")

@app.on_message(filters.command("subscribe") & filters.private)
async def subscribe(client, message):
    button = [[InlineKeyboardButton("Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ Ù‡Ù†Ø§", url="https://t.me/YourChannel")]]
    await message.reply("ÙŠØ±Ø¬Ù‰ Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ ÙÙŠ Ø§Ù„Ù‚Ù†Ø§Ø© Ù„Ù„Ø§Ø³ØªÙ…Ø±Ø§Ø±.", reply_markup=InlineKeyboardMarkup(button))

# 6. Ø§Ù„Ø±Ø¯ÙˆØ¯ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠØ©
@app.on_message(filters.text & filters.group)
async def auto_reply(client, message):
    if "Ù…Ø±Ø­Ø¨Ø§" in message.text:
        await message.reply("Ø£Ù‡Ù„Ø§Ù‹! ÙƒÙŠÙ Ø£Ø³Ø§Ø¹Ø¯ÙƒØŸ")

# 7. Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø¹Ù†Ø¯ ÙƒØªØ§Ø¨Ø© "Ø§ÙŠØ¯ÙŠ"
@app.on_message(filters.regex(r"(?i)^Ø§ÙŠØ¯ÙŠ$") & filters.group)
async def show_id(client, message):
    user_id = message.from_user.id
    username = message.from_user.username or "Ù„Ø§ ÙŠÙˆØ¬Ø¯"
    await message.reply(f"Ø§Ù„Ø£ÙŠØ¯ÙŠ: {user_id}\nØ§Ù„Ø§Ø³Ù…: @{username}")

# ØªØ´ØºÙŠÙ„ Ø§Ù„Ø¨ÙˆØª
if __name__ == "__main__":
    app.start()
    assistant.start()
    print("Ø§Ù„Ø¨ÙˆØª ÙŠØ¹Ù…Ù„ Ø§Ù„Ø¢Ù†")
    app.idle()
